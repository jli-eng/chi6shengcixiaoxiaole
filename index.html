<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ä¸­æ–‡å…­å¹´çº§ç”Ÿè¯æ¶ˆæ¶ˆä¹</title>
    <style>
        /* --- åŸºç¡€ä¸å­—ä½“è®¾ç½® --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Nunito:wght@700&display=swap');

        :root {
            --sky-blue-light: #a7e0ff;
            --sky-blue-dark: #69c0ff;
            --bubble-pink: rgba(255, 183, 197, 0.9);
            --bubble-yellow: rgba(255, 246, 183, 0.9);
            --bubble-green: rgba(183, 255, 197, 0.9);
            --bubble-purple: rgba(220, 183, 255, 0.9);
            --highlight-color: #ffdd57;
            --font-family: 'Nunito', 'Noto Sans SC', sans-serif;
            --text-color: #2c3e50;
            --white-color: #ffffff;
            --success-color: #27ae60;
            --start-btn-bg: #ff7675;
            --start-btn-hover: #d63031;
            --selected-color: #48dbfb;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            font-family: var(--font-family);
            overflow: hidden;
            background: linear-gradient(to bottom, var(--sky-blue-light), var(--sky-blue-dark));
            color: var(--text-color);
            user-select: none;
            font-weight: 700;
        }

        /* --- èƒŒæ™¯äº‘æœµåŠ¨ç”» --- */
        .cloud { position: absolute; background: var(--white-color); border-radius: 50%; opacity: 0.8; filter: blur(2px); animation: moveClouds 80s linear infinite; }
        .cloud:before, .cloud:after { content: ''; position: absolute; background: var(--white-color); border-radius: 50%; }
        .cloud1 { width: 200px; height: 60px; top: 10%; left: -250px; }
        .cloud1:before { width: 100px; height: 100px; top: -50px; left: 40px; }
        .cloud1:after { width: 140px; height: 120px; top: -60px; right: 20px; }
        .cloud2 { width: 250px; height: 80px; top: 25%; left: -300px; animation-duration: 60s; animation-delay: -20s; }
        .cloud2:before { width: 120px; height: 120px; top: -60px; left: 50px; }
        .cloud2:after { width: 160px; height: 140px; top: -70px; right: 30px; }
        .cloud3 { width: 180px; height: 50px; top: 60%; left: -200px; animation-duration: 100s; animation-delay: -40s; }
        .cloud3:before { width: 90px; height: 90px; top: -40px; left: 30px; }
        .cloud3:after { width: 120px; height: 100px; top: -50px; right: 20px; }
        @keyframes moveClouds { from { transform: translateX(0); } to { transform: translateX(calc(100vw + 300px)); } }

        /* --- æ•´ä½“å¸ƒå±€ --- */
        .game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 1.5vh 2vw;
            box-sizing: border-box;
            position: relative;
            z-index: 10;
        }

        /* --- æ§åˆ¶åŒº --- */
        .controls-area {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            padding: 1vh 2vw;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
            margin-bottom: 1.5vh;
            flex-shrink: 0;
        }
        
        .title {
            text-align: center;
            font-size: clamp(1.5em, 4vmin, 2.2em);
            color: var(--start-btn-hover);
            margin: 0 0 1vh 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        #unit-selection-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1vh;
        }

        #unit-selection-container label {
            display: flex;
            align-items: center;
            background: var(--white-color);
            padding: 0.8vh 1.5vw;
            font-size: clamp(0.8em, 2vmin, 1em);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #unit-selection-container input { margin-right: 8px; width: 1.8vmin; height: 1.8vmin; }
        
        #custom-list-container {
            padding: 1vh;
        }
        #custom-list-textarea {
            width: 100%;
            height: 80px;
            border-radius: 10px;
            border: 1px solid #ccc;
            padding: 10px;
            font-size: clamp(0.8em, 2vmin, 1em);
            box-sizing: border-box;
        }


        .game-info { 
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 10px;
        }
        .progress-container { justify-self: start; }
        .start-button-wrapper { justify-self: center; }
        .timer-container { justify-self: end; }
        
        .progress-container, .timer-container { font-size: clamp(0.8em, 2.2vmin, 1.1em); }
        .progress-bar { width: 20vw; max-width: 150px; height: 2.2vmin; min-height: 18px; background: #e0e0e0; border-radius: 10px; overflow: hidden; display: inline-block; margin-left: 10px; vertical-align: middle; }
        .progress-bar-inner { width: 0%; height: 100%; background: var(--success-color); border-radius: 10px; transition: width 0.5s ease; }

        .start-button {
            padding: 1vh 3vw;
            font-size: clamp(1em, 2.5vmin, 1.3em);
            border: none; border-radius: 15px; background: var(--start-btn-bg); color: var(--white-color); cursor: pointer;
            transition: all 0.3s ease; box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        .start-button:hover { background: var(--start-btn-hover); transform: translateY(-2px); }
        .start-button:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }

        /* --- æ¸¸æˆåŒº --- */
        .game-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 0;
        }

        .bubbles-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 1.2vmin;
            padding: 1.2vmin;
            width: 100%;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1) inset;
            flex-grow: 1;
            min-height: 0;
        }

        .bubble {
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(10px, 3.5vmin, 24px);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
            animation: float 6s ease-in-out infinite;
            padding: 5px;
            text-align: center;
            word-wrap: break-word;
            overflow: hidden;
        }

        .bubble:nth-child(4n+1) { background-color: var(--bubble-pink); animation-delay: 0s; }
        .bubble:nth-child(4n+2) { background-color: var(--bubble-yellow); animation-delay: -1.5s; }
        .bubble:nth-child(4n+3) { background-color: var(--bubble-green); animation-delay: -3s; }
        .bubble:nth-child(4n) { background-color: var(--bubble-purple); animation-delay: -4.5s; }
        
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
        
        .bubble.selected {
            transform: scale(1.1);
            box-shadow: 0 0 25px var(--selected-color);
            border: 4px solid var(--selected-color);
        }
        
        .bubble.pop {
            animation: pop-out 0.5s forwards;
            pointer-events: none;
        }
        @keyframes pop-out {
            0% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; visibility: hidden; }
        }

        .bubble.wrong { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* --- ç»“æŸå¼¹çª— --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; visibility: hidden; opacity: 0; transition: opacity 0.5s ease, visibility 0.5s ease; }
        .modal-overlay.show { visibility: visible; opacity: 1; }
        .modal-content { background: var(--white-color); padding: 40px; border-radius: 25px; text-align: center; transform: scale(0.7); transition: transform 0.5s ease; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-content h2 { font-size: 2.5em; color: var(--success-color); margin-top: 0; margin-bottom: 20px; }
        .modal-content p { font-size: 1.5em; margin-bottom: 30px; }

        /* --- çƒŸèŠ±æ•ˆæœ --- */
        .firework { position: absolute; width: 4px; height: 4px; background: #fff; border-radius: 50%; opacity: 1; animation: firework-explode 1s forwards; }
        @keyframes firework-explode { to { transform: translate(var(--x), var(--y)) scale(1.5); opacity: 0; } }

        /* --- å“åº”å¼è®¾è®¡ --- */
        @media (orientation: portrait) {
            .bubbles-container {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(6, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯äº‘æœµ -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <div class="cloud cloud3"></div>

    <div class="game-container">
        <!-- æ§åˆ¶åŒº -->
        <div class="controls-area">
            <h1 class="title">ä¸­æ–‡å…­å¹´çº§ç”Ÿè¯æ¶ˆæ¶ˆä¹ ğŸˆ</h1>
            <div id="unit-selection-container">
                <label><input type="checkbox" name="unit" value="lesson2"> ç¬¬äºŒè¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson4"> ç¬¬å››è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson5"> ç¬¬äº”è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson6"> ç¬¬å…­è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson7"> ç¬¬ä¸ƒè¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson8"> ç¬¬å…«è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson9"> ç¬¬ä¹è¯¾</label>
                <label><input type="checkbox" name="unit" value="lesson10"> ç¬¬åè¯¾</label>
                <label><input type="checkbox" name="unit" value="custom" id="custom-checkbox"> è‡ªå®šä¹‰</label>
            </div>
            <div id="custom-list-container" style="display: none;">
                <textarea id="custom-list-textarea" placeholder="è¯·è¾“å…¥ç”Ÿå­—å’Œè‹±æ–‡æ„æ€ï¼Œæ¯è¡Œä¸€å¯¹ï¼Œç”¨ç©ºæ ¼éš”å¼€ã€‚ä¾‹å¦‚:&#10;æˆ‘ I, me"></textarea>
            </div>
            <div class="game-info">
                <div class="progress-container">
                    <span>è¿›åº¦:</span>
                    <div class="progress-bar"><div class="progress-bar-inner"></div></div>
                </div>
                <div class="start-button-wrapper">
                    <button class="start-button" id="startButton" disabled>å¼€å§‹æ¸¸æˆ</button>
                </div>
                <div class="timer-container">
                    <span>æ—¶é—´:</span>
                    <span id="timer">0s</span>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆåŒº -->
        <div class="game-area">
            <div class="bubbles-container" id="bubblesContainer">
                <!-- æ³¡æ³¡ä¼šç”±JSåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div class="modal-overlay" id="winModal">
        <div class="modal-content">
            <h2 id="winMessage">ğŸ‰ æ­å–œä½ ï¼ğŸ‰</h2>
            <p id="winTime"></p>
            <button class="start-button" id="playAgainButton">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <!-- å¼•å…¥Tone.jsç”¨äºéŸ³æ•ˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM å…ƒç´ è·å– ---
            const startButton = document.getElementById('startButton');
            const playAgainButton = document.getElementById('playAgainButton');
            const bubblesContainer = document.getElementById('bubblesContainer');
            const timerEl = document.getElementById('timer');
            const progressBarInner = document.querySelector('.progress-bar-inner');
            const winModal = document.getElementById('winModal');
            const unitCheckboxes = document.querySelectorAll('input[name="unit"]');
            const customCheckbox = document.getElementById('custom-checkbox');
            const customListContainer = document.getElementById('custom-list-container');
            const customListTextarea = document.getElementById('custom-list-textarea');

            // --- ç”Ÿå­—æ•°æ® ---
            const wordLists = {
                lesson2: [
                    {char: "ä½ ", meaning: "you (singular)"},
                    {char: "å¥½", meaning: "good, well; hello, hi used in greeting"},
                    {char: "ä½ å¥½", meaning: "hello, how do you do"},
                    {char: "æˆ‘", meaning: "I, me"},
                    {char: "æ˜¯", meaning: "am, is, are"},
                    {char: "ä»–", meaning: "he, him"},
                    {char: "å¥¹", meaning: "she, her"},
                    {char: "å®ƒ", meaning: "it"},
                    {char: "è°", meaning: "who/whom"},
                    {char: "æ", meaning: "a family name; plum"},
                    {char: "å…°å…°", meaning: "a Chinese given name (å…°- orchid)"},
                    {char: "ç™½", meaning: "a family name; white"},
                    {char: "å¤§ä¼Ÿ", meaning: "Chinese for David (å¤§- big; ä¼Ÿ- great)"},
                    {char: "å†è§", meaning: "goodbye"},
                    {char: "æ—", meaning: "a family name; forest"},
                    {char: "è€å¸ˆ", meaning: "teacher"},
                    {char: "ä»¬", meaning: "[used after a pronoun or noun associated with people to show plural]"},
                    {char: "æˆ‘ä»¬", meaning: "we; us"},
                    {char: "ä½ ä»¬", meaning: "you (plural)"},
                    {char: "ä»–ä»¬", meaning: "they; them"},
                    {char: "å¥¹ä»¬", meaning: "they, them (all female)"},
                    {char: "åŒå­¦", meaning: "fellow student, schoolmate/classmate"},
                    {char: "åŒå­¦ä»¬", meaning: "fellow students, classmates"},
                    {char: "æ—©", meaning: "morning, early"},
                    {char: "æ˜å¤©", meaning: "tomorrow"},
                    {char: "è§", meaning: "to see"},
                    {char: "æ˜å¤©è§", meaning: "See you tomorrow"},
                    {char: "äº»", meaning: "standing person"},
                    {char: "å¥³", meaning: "woman, girl"},
                    {char: "æ—¥", meaning: "sun, clear"}
                ],
                lesson4: [
                    {char: "è°", meaning: "who, whom?"},
                    {char: "é©¬å…‹", meaning: "Chinese for Mark"},
                    {char: "å¥¹", meaning: "she, her"},
                    {char: "è€å¸ˆ", meaning: "teacher"},
                    {char: "å•Š", meaning: "(an exclamation)"},
                    {char: "æ¬¢è¿", meaning: "welcome"},
                    {char: "è¯·è¿›", meaning: "come in please"},
                    {char: "è°¢è°¢", meaning: "thanks"},
                    {char: "ç¥", meaning: "to wish (offer good wishes)"},
                    {char: "ç”Ÿæ—¥", meaning: "birthday"},
                    {char: "å¿«ä¹", meaning: "happy"},
                    {char: "ä»Šå¤©", meaning: "today"},
                    {char: "ä»Šå¹´", meaning: "this year"},
                    {char: "å‡ ", meaning: "how many"},
                    {char: "å²", meaning: "year of age"},
                    {char: "ä¸¤", meaning: "two (before measure words, age, and some numerals)"},
                    {char: "è°å•Šï¼Ÿ", meaning: "Who's itï¼Ÿ"},
                    {char: "æ˜¯æˆ‘ã€‚", meaning: "It's me!"},
                    {char: "ä½ æ˜¯è°ï¼Ÿ", meaning: "Who are you?"},
                    {char: "æˆ‘æ˜¯å…°å…°ã€‚", meaning: "I am lanlan."},
                    {char: "è¯·è¿›ã€‚", meaning: "Please come in."},
                    {char: "ç¥ä½ ç”Ÿæ—¥å¿«ä¹ã€‚", meaning: "Happy Birthday to you."},
                    {char: "ä½ ä»Šå¹´å‡ å²ï¼Ÿ", meaning: "How old are you this year?"},
                    {char: "ä½ å¤šå¤§ï¼Ÿ", meaning: "How old are you?"},
                    {char: "æˆ‘åä¸€å²ã€‚", meaning: "I am 11."},
                    {char: "ä»–/å¥¹å‡ å²ï¼Ÿ", meaning: "How old is he/she?"},
                    {char: "ä»–/å¥¹ä¸¤å²ã€‚", meaning: "He/she is two."},
                    {char: "ä½ å±ä»€ä¹ˆï¼Ÿ", meaning: "What's your zodiac animal?"},
                    {char: "å±", meaning: "belong to"}
                ],
                lesson5: [
                    {char: "è¿™", meaning: "this"},
                    {char: "é‚£", meaning: "that"},
                    {char: "ä»€ä¹ˆ", meaning: "what"},
                    {char: "çŸ¥é“", meaning: "to know"},
                    {char: "å—", meaning: "a question word for \"yes-no\" questions"},
                    {char: "ä¸", meaning: "no, not; tone changes to second when followed by fourth tone"},
                    {char: "æ•™å®¤", meaning: "classroom"},
                    {char: "é—¨", meaning: "door"},
                    {char: "æ¡Œå­", meaning: "desk"},
                    {char: "æ¤…å­", meaning: "chair"},
                    {char: "ç™½æ¿", meaning: "whiteboard"},
                    {char: "çº¸", meaning: "paper"},
                    {char: "å°º", meaning: "ruler"},
                    {char: "ç¬”", meaning: "pen, pencil"},
                    {char: "ä¹¦", meaning: "book"},
                    {char: "æ¯›ç¬”", meaning: "writing brush"},
                    {char: "å‰ªåˆ€", meaning: "scissors"},
                    {char: "ä¹¦åŒ…", meaning: "schoolbag"},
                    {char: "æ©¡çš®", meaning: "eraser"},
                    {char: "çš„", meaning: "(a possessive particle used after pronoun/noun)"},
                    {char: "è°çš„", meaning: "whose"},
                    {char: "æˆ‘çš„", meaning: "my, mine"},
                    {char: "ä½ çš„", meaning: "your, yours"},
                    {char: "å¤§æ¦‚", meaning: "probably"},
                    {char: "ä¸æ˜¯", meaning: "no (negative form of shÃ¬)"},
                    {char: "å°æ˜", meaning: "a Chinese given name"},
                    {char: "æ˜¯çš„", meaning: "Yes! Right! Correct!ï¼ˆpositive answer to questions using the verb shÃ¬ æ˜¯ï¼‰"},
                    {char: "ä¸å®¢æ°”", meaning: "not at all, don't mention it, you're welcome"},
                    {char: "å’Œ", meaning: "and"},
                    {char: "è¿™æ˜¯ä»€ä¹ˆï¼Ÿ", meaning: "What is this?"},
                    {char: "é‚£æ˜¯ä»€ä¹ˆï¼Ÿ", meaning: "What is that?"},
                    {char: "æˆ‘ä¸çŸ¥é“ã€‚", meaning: "I don't know."},
                    {char: "ä½ çŸ¥é“å—ï¼Ÿ", meaning: "Do you know?"},
                    {char: "è¿™æ˜¯è°çš„æ©¡çš®ï¼Ÿ", meaning: "Whose eraser is this?"},
                    {char: "é‚£æ˜¯é©¬å…‹çš„ã€‚", meaning: "That is Mark's."},
                    {char: "å¤§æ¦‚æ˜¯è€å¸ˆçš„ã€‚", meaning: "It's probably the teacher's."},
                    {char: "è¿™æ˜¯ä½ çš„ä¹¦åŒ…å—ï¼Ÿ", meaning: "Is this your school bag?"},
                    {char: "ä¸æ˜¯ï¼Œé‚£ä¸æ˜¯æˆ‘çš„ã€‚", meaning: "No, that's not mine."},
                    {char: "æ˜¯çš„ï¼Œè¿™æ˜¯æˆ‘çš„ã€‚", meaning: "Yes, it's mine."},
                    {char: "è¾¶", meaning: "walking, movement"},
                    {char: "é˜", meaning: "city"},
                    {char: "äº»", meaning: "standing person"},
                    {char: "å£", meaning: "mouthï¼Œsoundingï¼Œopening"},
                    {char: "ç™½", meaning: "white"}
                ],
                lesson6: [
                    {char: "çˆ¸çˆ¸", meaning: ""},
                    {char: "å¦ˆå¦ˆ", meaning: ""},
                    {char: "å“¥å“¥", meaning: ""},
                    {char: "å§å§", meaning: ""},
                    {char: "å¼Ÿå¼Ÿ", meaning: ""},
                    {char: "å¦¹å¦¹", meaning: ""},
                    {char: "å¤–å…¬", meaning: "mother's dad"},
                    {char: "å¤–å©†", meaning: "mother's mom"},
                    {char: "çˆ·çˆ·", meaning: "father's dad"},
                    {char: "å¥¶å¥¶", meaning: "father's mom"},
                    {char: "å®¶", meaning: "family, home"},
                    {char: "å®¶äºº", meaning: "family members"},
                    {char: "æœ‰", meaning: "to have, there is/are"},
                    {char: "å‡ ", meaning: "how much / how many / several / a few"},
                    {char: "ä¸ª", meaning: "(a common measure word which can be used for people)"},
                    {char: "ä½ å®¶æœ‰å‡ ä¸ªäººï¼Ÿ", meaning: "How many people are there in your family?"},
                    {char: "æ²¡", meaning: "a negative word"},
                    {char: "æ²¡æœ‰", meaning: "not have"},
                    {char: "ä¹Ÿ", meaning: "also, too"},
                    {char: "å’Œ", meaning: "and"},
                    {char: "å‘¢", meaning: "(a question word) how about"},
                    {char: "å§“", meaning: "to be surnamed; to have the surname"},
                    {char: "æˆ‘å§“æã€‚", meaning: "I have the surname Li."},
                    {char: "å«", meaning: "to (be) call(ed)"},
                    {char: "åå­—", meaning: "name"},
                    {char: "å§“å", meaning: "full name"},
                    {char: "å­¦ç”Ÿ", meaning: "student"},
                    {char: "å·¥äºº", meaning: "labourer, worker"},
                    {char: "æŠ¤å£«", meaning: "nurse"},
                    {char: "åŒ»ç”Ÿ", meaning: "doctor"},
                    {char: "ä¸½ä¸½", meaning: "Chinese for Lily"},
                    {char: "è¿™æ˜¯æˆ‘çš„çˆ¸çˆ¸ã€‚", meaning: "this is my dad"},
                    {char: "ä»–ä»Šå¹´å››åäº”å²ã€‚", meaning: "He's 45 years old."},
                    {char: "ä»–æ˜¯å·¥äººã€‚", meaning: "He is a worker."},
                    {char: "ä½ å§“ä»€ä¹ˆï¼Ÿ", meaning: "What is your last name?"},
                    {char: "ä½ å«ä»€ä¹ˆï¼Ÿ", meaning: "What is your name?"},
                    {char: "æˆ‘å®¶æœ‰ä¸‰ä¸ªäººï¼Œä½ å®¶å‘¢ï¼Ÿ", meaning: "My family has 3 people. How about yours?"},
                    {char: "ä½ æœ‰å“¥å“¥å—ï¼Ÿ", meaning: "Do you have older brothers?"},
                    {char: "æœ‰ï¼Œæˆ‘æœ‰ä¸€ä¸ªå“¥å“¥ã€‚", meaning: "Yes, I have an older brother."},
                    {char: "ä½ æœ‰æ²¡æœ‰å§å§ï¼Ÿ", meaning: "Do you have an older sister?"},
                    {char: "æ²¡æœ‰ï¼Œæˆ‘æ²¡æœ‰å§å§ã€‚", meaning: "No, I don't have older sisters."},
                    {char: "ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ", meaning: "What is your name?"},
                    {char: "çˆ¶", meaning: "father"},
                    {char: "å¥³", meaning: "women"},
                    {char: "å®€", meaning: "roof with chimney"},
                    {char: "æœˆ", meaning: "moonï¼›month"},
                    {char: "å£", meaning: "mouth; sounding; opening"}
                ],
                lesson7: [
                    {char: "ä½ å®¶æœ‰ä»€ä¹ˆå® ç‰©ï¼Ÿ", meaning: "What pets does your family have?"},
                    {char: "ä½ å®¶æœ‰ä»€ä¹ˆäººï¼Ÿ", meaning: "What members does your family have?"},
                    {char: "åŠ¨ç‰©", meaning: "animal"},
                    {char: "å® ç‰©", meaning: "pet"},
                    {char: "çŒ«", meaning: "cat"},
                    {char: "ç‹—", meaning: "dog"},
                    {char: "é©¬", meaning: "horse"},
                    {char: "é‡‘é±¼", meaning: "goldfish"},
                    {char: "é¸Ÿ", meaning: "bird"},
                    {char: "ç¾Š", meaning: "sheep"},
                    {char: "é¾™", meaning: "dragon"},
                    {char: "ç†ŠçŒ«", meaning: "panda"},
                    {char: "è€é¼ ", meaning: "rat / mouse"},
                    {char: "å…”å­", meaning: "rabbit, hare"},
                    {char: "è›‡", meaning: "snake"},
                    {char: "é¸¡", meaning: "chicken"},
                    {char: "åª", meaning: "a measure word for most animals"},
                    {char: "åŒ¹", meaning: "a measure word for horses, mules"},
                    {char: "æ¡", meaning: "measure word for long, thin things (i.e. ribbon, river, etc.); a strip; item; article"},
                    {char: "å¾ˆ", meaning: "to be (is, am, are); very"},
                    {char: "å¤§", meaning: "big"},
                    {char: "å°", meaning: "small, little (in size)"},
                    {char: "å‡¶", meaning: "fierce, ferocious"},
                    {char: "å¯çˆ±", meaning: "cute / lovely"},
                    {char: "çœŸ", meaning: "really"},
                    {char: "æ˜¯å•Š", meaning: "yes, yeah (shows agreement)"},
                    {char: "å®ƒ", meaning: "it"},
                    {char: "éƒ½", meaning: "both; all"},
                    {char: "æœ‰......å—ï¼Ÿ", meaning: "have or not?"},
                    {char: "æœ‰......å—=æœ‰æ²¡æœ‰", meaning: "to have or not have (Do you have~)"},
                    {char: "ä½ å®¶æœ‰å® ç‰©å—ï¼Ÿ", meaning: "Does your family have pets?"},
                    {char: "æˆ‘å®¶æœ‰ä¸¤åªç‹—ï¼Œå››åŒ¹é©¬ï¼Œå…­æ¡é‡‘é±¼ï¼Œäº”åªçŒ«å’Œä¸‰åªé¸Ÿã€‚", meaning: "My family has 2 dogs, 4 horses, 6 fish, 5 cats and 3 birds."},
                    {char: "è¿™åŒ¹é©¬å¾ˆå¤§ã€‚", meaning: "This horse is big."},
                    {char: "é‚£åªé¸Ÿå¾ˆå°ã€‚", meaning: "That bird is small."},
                    {char: "è¿™åªç‹—å¾ˆå‡¶ã€‚", meaning: "This dog is fierce."},
                    {char: "è¿™ä¸ªå°å¦¹å¦¹å¾ˆå¯çˆ±ã€‚", meaning: "This little girl is cute."},
                    {char: "é‚£åªç‹—æ˜¯è°çš„ï¼Ÿ", meaning: "Whose dog is that?"},
                    {char: "æ˜¯æˆ‘çš„ã€‚", meaning: "It is mine."},
                    {char: "ä½ çš„ç‹—çœŸå°ã€‚", meaning: "Your dog is really small."},
                    {char: "æ˜¯å•Šï¼å®ƒå¾ˆå¯çˆ±ã€‚", meaning: "Yes, it is cute."},
                    {char: "ä½ æœ‰æ²¡æœ‰ç‹—ï¼Ÿ", meaning: "Do you have a dog?"},
                    {char: "ä½ å®¶æœ‰ä»€ä¹ˆäººï¼Ÿ /ä½ å®¶æœ‰è°ï¼Ÿ", meaning: "What members does your family have? /Who are the people in your family?"},
                    {char: "æˆ‘å®¶æœ‰çˆ¸çˆ¸ã€å¦ˆå¦ˆã€å“¥å“¥å’Œæˆ‘ã€‚", meaning: "My family has dad, mom, older brother and me."}
                ],
                lesson8: [
                    {char: "ä¸­å›½", meaning: "China"},
                    {char: "è‹±å›½", meaning: "England"},
                    {char: "ç¾å›½", meaning: "United States; America"},
                    {char: "å¾·å›½", meaning: "Germany"},
                    {char: "åŠ æ‹¿å¤§", meaning: "Canada"},
                    {char: "æ—¥æœ¬", meaning: "Japan"},
                    {char: "æ–°è¥¿å…°", meaning: "New Zealand"},
                    {char: "æ¾³å¤§åˆ©äºš", meaning: "Australia"},
                    {char: "æ³•å›½", meaning: "France"},
                    {char: "å›½å®¶", meaning: "country"},
                    {char: "å¤–å›½", meaning: "foreign country"},
                    {char: "è¯­è¨€", meaning: "language"},
                    {char: "å¤–è¯­", meaning: "Foreign language"},
                    {char: "å“ª", meaning: "which"},
                    {char: "å›½", meaning: "country"},
                    {char: "ä½ æ˜¯å“ªå›½äººï¼Ÿ", meaning: "What is your nationality?"},
                    {char: "ä¹Ÿ", meaning: "also, too"},
                    {char: "æ˜¯ä¸æ˜¯", meaning: "is or isn't/yes or no/whether or not"},
                    {char: "æ˜¯......å—", meaning: "yes or not?"},
                    {char: "æœ‰æ²¡æœ‰", meaning: "to have or not have (Do you have~)"},
                    {char: "æœ‰......å—", meaning: "have or not?"},
                    {char: "å¯¹ä¸èµ·", meaning: "I'm sorry"},
                    {char: "æ²¡å…³ç³»", meaning: "it doesn't matter, that's all right"},
                    {char: "è¯·é—®", meaning: "may I ask"},
                    {char: "å°å¦¹å¦¹", meaning: "little girl"},
                    {char: "ä¼š", meaning: "can, to be able to"},
                    {char: "ä¸ä¼š", meaning: "to be unable to, cannot"},
                    {char: "ä¼šä¸ä¼š", meaning: "can or cannot"},
                    {char: "ä¼š......å—", meaning: "can or not?"},
                    {char: "è¯´", meaning: "to speak, to say"},
                    {char: "æ±‰è¯­", meaning: "Chinese language"},
                    {char: "å’¦", meaning: "why! huh! (indicating surprise)"},
                    {char: "ä¸€ç‚¹å„¿", meaning: "a little, a bit"},
                    {char: "å¾—", meaning: "(used after a verb to indicate the degree or result)"},
                    {char: "å“ªé‡Œï¼å“ªé‡Œï¼", meaning: "not at all (said when praised; literally where)"},
                    {char: "è‹±è¯­", meaning: "English"},
                    {char: "æ—¥è¯­", meaning: "Japanese language"},
                    {char: "å¾·è¯­", meaning: "German language"},
                    {char: "ä½ æ˜¯å“ªå›½äººï¼Ÿ", meaning: "What is your nationality?"},
                    {char: "ä½ æ˜¯ä¸­å›½äººå—ï¼Ÿ", meaning: "Are you Chineseï¼Ÿ"},
                    {char: "ä½ å¦ˆå¦ˆä¹Ÿæ˜¯è‹±å›½äººå—?", meaning: "Is your mom also English?"},
                    {char: "ä¸æ˜¯ï¼Œå¥¹æ˜¯ç¾å›½äººã€‚", meaning: "No, she is American."},
                    {char: "æ²¡å…³ç³»", meaning: "Doesn't Matter"},
                    {char: "è¯·é—®ï¼Œä½ æ˜¯ä¸æ˜¯ç¾å›½äººï¼Ÿ", meaning: "May I ask, are you American?"},
                    {char: "ä½ ä¼šè¯´æ±‰è¯­å—ï¼Ÿ", meaning: "Can you speak Chinese?"},
                    {char: "å¥¹ä¸ä¼šè¯´æ±‰è¯­ã€‚", meaning: "She doesn't speak Chinese."},
                    {char: "æˆ‘ä¼šè¯´ä¸€ç‚¹å„¿æ±‰è¯­ã€‚", meaning: "I can speak a bit of Chinese."},
                    {char: "ä½ è¯´å¾—å¾ˆå¥½ã€‚", meaning: "You speak very well"},
                    {char: "ä½ ä¼šä¸ä¼šè¯´å¾·è¯­ï¼Ÿ", meaning: "Can you speak German?"},
                    {char: "ä½ ä¼šè¯´ä»€ä¹ˆè¯­è¨€ï¼Ÿ", meaning: "What language can you speak?"},
                    {char: "ä»–è‹±è¯­è¯´å¾—å¾ˆå¥½ã€‚", meaning: "He speaks English well."},
                    {char: "å›—", meaning: "enclosure"},
                    {char: "é—¨", meaning: "door"},
                    {char: "è® ", meaning: "speech"}
                ],
                lesson9: [
                    {char: "è¿åŠ¨", meaning: "sports, exercise"},
                    {char: "ä½ çš„è¿åŠ¨æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆè¿åŠ¨ N.ï¼‰", meaning: "What sports do you play?"},
                    {char: "ä½ ä»Šå¤©è¿åŠ¨äº†å—ï¼Ÿï¼ˆè¿åŠ¨ V.ï¼‰", meaning: "Did you exercise today?"},
                    {char: "å–œæ¬¢", meaning: "to like"},
                    {char: "æ¸¸æ³³", meaning: "swimming, to swim"},
                    {char: "éª‘è½¦", meaning: "cycling, to ride a bike"},
                    {char: "è·‘æ­¥", meaning: "running, to jog"},
                    {char: "è¸¢", meaning: "to kick, to play (soccer)"},
                    {char: "è¶³çƒ", meaning: "soccer"},
                    {char: "è¸¢è¶³çƒ", meaning: "to play soccer"},
                    {char: "æ‰“", meaning: "to hit; to play (ball game, taichi, etc.); to dial (telephone)"},
                    {char: "ç¯®çƒ", meaning: "basketball"},
                    {char: "æ‰“ç¯®çƒ", meaning: "play basketball"},
                    {char: "ç½‘çƒ", meaning: "tennis"},
                    {char: "ä¹’ä¹“çƒ", meaning: "table tennis"},
                    {char: "æ¿çƒ", meaning: "cricket (ball game)"},
                    {char: "å–‚", meaning: "hello; hey"},
                    {char: "å»", meaning: "to go"},
                    {char: "å¥½å—", meaning: "OK? (expression to ask for agreement)"},
                    {char: "å¥½å•Š", meaning: "ok!/good! (agreeing)"},
                    {char: "æœ€", meaning: "most"},
                    {char: "ä¸å»", meaning: "not going"},
                    {char: "èµ°", meaning: "to go, to walk (physically)"},
                    {char: "å§", meaning: "(an expression used at the end of a sentence to indicate suggestion)"},
                    {char: "æˆ‘ä»¬èµ°å§", meaning: "let's go"},
                    {char: "å¿™", meaning: "busy"},
                    {char: "çƒ", meaning: "ball"},
                    {char: "ä½ å–œæ¬¢è¿åŠ¨å—ï¼Ÿ", meaning: "Do you like doing exercise?"},
                    {char: "ä½ å–œä¸å–œæ¬¢è¿åŠ¨ï¼Ÿ", meaning: "Do you like doing exercise?"},
                    {char: "ä½ å–œæ¬¢ä¸å–œæ¬¢è¿åŠ¨ï¼Ÿ", meaning: "Do you like doing exercise?"},
                    {char: "ä½ å–œæ¬¢ä»€ä¹ˆè¿åŠ¨ï¼Ÿ", meaning: "What sports do you like?"},
                    {char: "ä½ å–œæ¬¢æ¸¸æ³³å—ï¼Ÿ", meaning: "Do you like swimming?"},
                    {char: "æˆ‘å–œæ¬¢ï¼Œä½ å‘¢ï¼Ÿ", meaning: "I like it, how about you?"},
                    {char: "æˆ‘ä¸å–œæ¬¢è¸¢è¶³çƒã€‚", meaning: "I don't like to play football."},
                    {char: "ä½ å–œæ¬¢ä¸å–œæ¬¢æ‰“ç¯®çƒï¼Ÿ", meaning: "Do you like to play basketball?"},
                    {char: "å–‚ï¼Œæˆ‘ä»¬å»æ‰“æ¿çƒï¼Œå¥½å—ï¼Ÿ", meaning: "Hey, let's go to play cricket, all right?"},
                    {char: "å¥½å•Šï¼æˆ‘æœ€å–œæ¬¢æ‰“ä¹’ä¹“çƒã€‚", meaning: "OKã€‚I like to play table tennis the most."},
                    {char: "æˆ‘ä¸å»ã€‚æˆ‘å¾ˆå¿™ã€‚", meaning: "I can't go. I am busy."},
                    {char: "æˆ‘ä»¬èµ°å§ï¼", meaning: "Let's go."},
                    {char: "ä½ å–œä¸å–œæ¬¢è·‘æ­¥ï¼Ÿ", meaning: "Do you like running?"},
                    {char: "ä½ æœ€å–œæ¬¢ä»€ä¹ˆè¿åŠ¨ï¼Ÿ", meaning: "What sport do you like the mostï¼Ÿ"},
                    {char: "å£", meaning: "mouthï¼›soundingï¼›opening"},
                    {char: "â»Œ", meaning: "walkingï¼›movement"},
                    {char: "åŠ›", meaning: "strengthï¼›power"},
                    {char: "æ‰Œ", meaning: "hand; hand actions"},
                    {char: "ç‹", meaning: "jade; king"}
                ],
                lesson10: [
                    {char: "çœ‰æ¯›", meaning: "eyebrow"},
                    {char: "çœ¼ç›", meaning: "eye"},
                    {char: "é¼»å­", meaning: "nose"},
                    {char: "å˜´å·´", meaning: "mouth"},
                    {char: "å¤´", meaning: "head"},
                    {char: "è€³æœµ", meaning: "ear"},
                    {char: "è„¸", meaning: "face"},
                    {char: "å¤´å‘", meaning: "hair"},
                    {char: "é•¿", meaning: "long"},
                    {char: "çŸ­", meaning: "short"},
                    {char: "æœ‹å‹", meaning: "friend"},
                    {char: "ç‹", meaning: "king, a surname"},
                    {char: "ç¾æ€¡", meaning: "a given name"},
                    {char: "ä¸Š", meaning: "to go, to attend"},
                    {char: "å¹´çº§", meaning: "grade"},
                    {char: "å­¦æ ¡", meaning: "school"},
                    {char: "ç¢§ä¸˜å­¦æ ¡", meaning: "Greenhills School"},
                    {char: "åŒå­¦", meaning: "classmate"},
                    {char: "åŒç­", meaning: "same class"},
                    {char: "å’Œ......åŒç­", meaning: "be in the same class as somebody"},
                    {char: "å£", meaning: "mouth, sounding, opening"},
                    {char: "æœˆ", meaning: "moon; body related"},
                    {char: "çºŸ", meaning: "silkï¼›fabric"},
                    {char: "ç¦¾", meaning: "crops"},
                    {char: "å†‚", meaning: "border"},
                    {char: "å­", meaning: "child; son"},
                    {char: "åˆ", meaning: "right hand; again"},
                    {char: "è¿™æ˜¯æˆ‘ä»¬çš„å­¦æ ¡ã€‚", meaning: "This is our school."},
                    {char: "ä½ ä»¬çš„å­¦æ ¡çœŸå¤§ã€‚", meaning: "Your school is really big."},
                    {char: "ä»–æ˜¯æˆ‘çš„åŒå­¦ï¼Œç™½å¤§ä¼Ÿã€‚", meaning: "He is my classmate, David Bai."},
                    {char: "è¿™æ˜¯æˆ‘çš„æœ‹å‹ã€‚å¥¹å«ç‹ç¾æ€¡ã€‚", meaning: "This is my friend. She is called Meiyi Wang."},
                    {char: "ä½ ä¸Šå‡ å¹´çº§ï¼Ÿ", meaning: "What grade are you going to?"},
                    {char: "æˆ‘ä¸Šä¹å¹´çº§ï¼Œä½ å‘¢ï¼Ÿ", meaning: "I'm in ninth grade, how about you?"},
                    {char: "å…°å…°ä¹Ÿä¸Šä¸ƒå¹´çº§ã€‚", meaning: "Lanlan is also in 7th grade."},
                    {char: "å¤§ä¼Ÿå’Œæˆ‘åŒç­ã€‚", meaning: "David and me are in the same class."},
                    {char: "å°æ˜ä¹Ÿå’Œä½ åŒç­å—ï¼Ÿ", meaning: "Is Xiao Ming also in the same class as you?"},
                    {char: "æ˜¯çš„ï¼Œæˆ‘ä»¬éƒ½åŒç­ã€‚", meaning: "Yes, we are all in the same class."},
                    {char: "èµ°ï¼Œæˆ‘ä»¬å»æ‰“ç½‘çƒå§ï¼", meaning: "Go, let go to play tennis."},
                    {char: "å¥½å•Šï¼æˆ‘ä»¬èµ°ã€‚", meaning: "OK! Let's go."},
                    {char: "ä¸ï¼Œæˆ‘ä¸å’Œå¥¹åŒç­ã€‚", meaning: "No, I'm not in the same class as her."}
                ]
            };

            // --- éŸ³æ•ˆåˆæˆå™¨ ---
            let synth;
            const correctSound = () => { if (synth) synth.triggerAttackRelease('C5', '8n', Tone.now()); };
            const wrongSound = () => { if (synth) synth.triggerAttackRelease('G3', '8n', Tone.now()); };
            const popSound = () => { if(Tone && Tone.MembraneSynth){ const popSynth = new Tone.MembraneSynth().toDestination(); popSynth.triggerAttackRelease('C2', '8n', Tone.now()); } };

            // --- æ¸¸æˆçŠ¶æ€å˜é‡ ---
            let gameState = { isGameRunning: false, timerId: null, seconds: 0, firstSelection: null, totalPairs: 0, foundPairs: 0 };

            // --- äº‹ä»¶ç›‘å¬ ---
            startButton.addEventListener('click', startGame);
            playAgainButton.addEventListener('click', startGame);
            bubblesContainer.addEventListener('click', handleBubbleClick);
            unitCheckboxes.forEach(checkbox => checkbox.addEventListener('change', checkStartButtonState));
            customListTextarea.addEventListener('input', checkStartButtonState);


            function checkStartButtonState() {
                const anyUnitChecked = Array.from(unitCheckboxes).some(cb => cb.checked && cb.value !== 'custom');
                const customChecked = customCheckbox.checked;
                customListContainer.style.display = customChecked ? 'block' : 'none';

                if (customChecked) {
                    startButton.disabled = parseCustomList(customListTextarea.value).length === 0;
                } else {
                    startButton.disabled = !anyUnitChecked;
                }
            }


            // --- æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---
            function startGame() {
                // åˆå§‹åŒ–éŸ³æ•ˆ
                if (!synth && typeof Tone !== 'undefined') { 
                    try { 
                        synth = new Tone.PolySynth(Tone.FMSynth).toDestination();
                    } catch (e) { 
                        console.error("Tone.js could not be initialized.", e); 
                    } 
                }

                // é‡ç½®æ¸¸æˆçŠ¶æ€
                if (gameState.timerId) clearInterval(gameState.timerId);
                gameState = { ...gameState, isGameRunning: true, seconds: 0, foundPairs: 0, firstSelection: null };
                bubblesContainer.innerHTML = '';
                winModal.classList.remove('show');
                timerEl.textContent = '0s';

                // è·å–ç”Ÿå­—åˆ—è¡¨
                let wordList = getWordList();
                if (wordList.length < 12) {
                    alert('æ‰€é€‰å•å…ƒçš„ç”Ÿå­—ä¸è¶³12å¯¹ï¼Œè¯·é€‰æ‹©æ›´å¤šå•å…ƒæˆ–åœ¨è‡ªå®šä¹‰ä¸­æ·»åŠ ï¼');
                    return;
                }

                // å‡†å¤‡æ¸¸æˆæ•°æ®
                const gamePairs = shuffleArray(wordList).slice(0, 12);
                gameState.totalPairs = gamePairs.length;
                let allBubblesData = [];
                gamePairs.forEach((pair, index) => {
                    allBubblesData.push({ value: pair.char, type: 'char', pairId: index });
                    allBubblesData.push({ value: pair.meaning, type: 'meaning', pairId: index });
                });
                
                // åˆ›å»ºæ³¡æ³¡å¹¶å¼€å§‹è®¡æ—¶
                shuffleArray(allBubblesData).forEach(data => createBubble(data));
                updateProgress();
                gameState.timerId = setInterval(updateTimer, 1000);
            }
            
            function getWordList() {
                let combinedList = [];
                unitCheckboxes.forEach(checkbox => {
                    if (checkbox.checked && checkbox.value !== 'custom') {
                        combinedList = combinedList.concat(wordLists[checkbox.value]);
                    }
                });

                if (customCheckbox.checked) {
                    combinedList = combinedList.concat(parseCustomList(customListTextarea.value));
                }
                // å»é‡
                return combinedList.filter((item, index, self) => 
                    index === self.findIndex((t) => (
                        t.char === item.char && t.meaning === item.meaning
                    ))
                );
            }

            function parseCustomList(text) {
                return text.split('\n')
                           .map(line => line.trim())
                           .filter(line => line)
                           .map(line => {
                               const parts = line.split(/\s+/);
                               if (parts.length >= 2) {
                                   return { char: parts[0], meaning: parts.slice(1).join(' ') };
                               }
                               return null;
                           })
                           .filter(item => item);
            }


            function handleBubbleClick(e) {
                if (!gameState.isGameRunning) return;
                const clickedBubble = e.target.closest('.bubble');
                if (!clickedBubble || clickedBubble.classList.contains('pop')) return;

                if (gameState.firstSelection === clickedBubble) {
                    clickedBubble.classList.remove('selected');
                    gameState.firstSelection = null;
                    return;
                }

                if (!gameState.firstSelection) {
                    gameState.firstSelection = clickedBubble;
                    clickedBubble.classList.add('selected');
                } else {
                    const first = gameState.firstSelection.dataset;
                    const second = clickedBubble.dataset;

                    if (first.pairId === second.pairId && first.type !== second.type) {
                        correctSound();
                        popSound();
                        gameState.firstSelection.classList.add('pop');
                        clickedBubble.classList.add('pop');
                        gameState.foundPairs++;
                        updateProgress();
                        if (gameState.foundPairs === gameState.totalPairs) {
                            endGame();
                        }
                    } else {
                        wrongSound();
                        gameState.firstSelection.classList.add('wrong');
                        clickedBubble.classList.add('wrong');
                        setTimeout(() => {
                            gameState.firstSelection.classList.remove('wrong');
                            clickedBubble.classList.remove('wrong');
                        }, 400);
                    }
                    gameState.firstSelection.classList.remove('selected');
                    gameState.firstSelection = null;
                }
            }

            function endGame() {
                clearInterval(gameState.timerId);
                gameState.isGameRunning = false;
                document.getElementById('winMessage').textContent = 'ğŸ‰ å¤ªæ£’å•¦ï¼å…¨éƒ¨å®Œæˆï¼ ğŸ‰';
                document.getElementById('winTime').textContent = `ç”¨æ—¶: ${gameState.seconds} ç§’`;
                winModal.classList.add('show');
                for (let i = 0; i < 30; i++) createFirework();
            }

            function createBubble(data) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = data.value;
                bubble.dataset.value = data.value;
                bubble.dataset.type = data.type;
                bubble.dataset.pairId = data.pairId;
                bubblesContainer.appendChild(bubble);
            }

            function updateTimer() {
                gameState.seconds++;
                timerEl.textContent = `${gameState.seconds}s`;
            }
            
            function updateProgress() {
                const percentage = gameState.totalPairs > 0 ? (gameState.foundPairs / gameState.totalPairs) * 100 : 0;
                progressBarInner.style.width = `${percentage}%`;
            }

            function createFirework() {
                const firework = document.createElement('div');
                firework.className = 'firework';
                const modalContent = winModal.querySelector('.modal-content');
                modalContent.appendChild(firework);
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * 150 + 50;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                firework.style.setProperty('--x', `${x}px`);
                firework.style.setProperty('--y', `${y}px`);
                firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                const startX = modalContent.offsetWidth / 2;
                const startY = modalContent.offsetHeight / 2;
                firework.style.left = `${startX}px`;
                firework.style.top = `${startY}px`;
                setTimeout(() => firework.remove(), 1000);
            }

            function shuffleArray(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            }
        });
    </script>
</body>
</html>
    
